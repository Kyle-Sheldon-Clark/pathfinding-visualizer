<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Pathfinding Visualizer</title>
</head>
<body>
    <div id="toolbar"></div>
    <div id="gridContainer"></div>
    <script>
        let numOfRows = 40;
        let toolbarHeight = document.getElementById('toolbar').clientHeight;
        let squareWidth = (window.innerHeight-toolbarHeight)/numOfRows;
        let numOfSquaresPerRow = (window.innerWidth/squareWidth);

        function createGrid() {
            for (let i = 0; i < numOfRows; i++) {
                let row = document.createElement('div');
                row.setAttribute('class', 'row');
                document.getElementById('gridContainer').appendChild(row);
                for (let j = 0; j < numOfSquaresPerRow; j++) {
                    let square = document.createElement('div');
                    square.style.width = `${squareWidth}px`;
                    square.style.height = `${squareWidth}px`;
                    square.setAttribute('class', `square`);
                    square.setAttribute('id', `${i}-${j}`);
                    square.disabled = false;
                    square.addEventListener('click', function() {
                        toggleSquare(square);
                    });
                    row.appendChild(square);
                }
            }
        }

        function toggleSquare(currentSquare) {
            if (currentSquare.classList.contains('disabled')) {
                currentSquare.classList.remove('disabled');
            } else {
                currentSquare.classList.add('disabled');
            }
        }

        let wallsToCheck = [];

        function primsMaze() {
            for (let i = 0; i < numOfRows; i++) {
                for (let j = 0; j < numOfSquaresPerRow; j++) {
                    document.getElementById(`${i}-${j}`).classList.add('disabled');
                } 
            }
            let randomRow = Math.floor(Math.random()*((numOfRows-1)-1) + 1);
            let randomColumn = Math.floor(Math.random()*((numOfSquaresPerRow-1)-1) + 1);
            document.getElementById(`${randomRow}-${randomColumn}`).classList.remove('disabled');
            let currentNeighbours = getNeighbours(randomRow, randomColumn);
            for (let k = 0; k < currentNeighbours.length; k++) {
                wallsToCheck.push(currentNeighbours[k]);
            }
            while (wallsToCheck.length > 0) {
                    let randomWallIndex = Math.floor(Math.random()*(wallsToCheck.length-1));
                    let randomWall = wallsToCheck[randomWallIndex].split('-');
                    evaluateWall(parseInt(randomWall[0]), parseInt(randomWall[1]));
                    wallsToCheck.splice(randomWallIndex, 1);
            }
        }

        function getNeighbours(selectedRow, selectedColumn) {
            let neighbours = [];
            if (selectedRow > 1) {
                neighbours.push(`${selectedRow-1}-${selectedColumn}`);
            }
            if (selectedColumn < numOfSquaresPerRow - 3) {
                neighbours.push(`${selectedRow}-${selectedColumn+1}`);
            }
            if (selectedRow < numOfRows - 2) {
                neighbours.push(`${selectedRow+1}-${selectedColumn}`);
            }
            if (selectedColumn > 1) {
                neighbours.push(`${selectedRow}-${selectedColumn-1}`);
            }
            return neighbours;
        }

        function getNeighbourInfo(selectedRow, selectedColumn) {
            let neighbours = getNeighbours(selectedRow, selectedColumn);
            let neighboursNotInMaze = [];
            let neighboursInMaze = [];
            for (let i = 0; i < neighbours.length; i++) {
                let currentSquareId = neighbours[i].split('-');
                if (!document.getElementById(`${currentSquareId[0]}-${currentSquareId[1]}`).classList.contains('disabled')) {
                    neighboursInMaze.push(neighbours[i]);
                } else {
                    neighboursNotInMaze.push(neighbours[i]);
                }
            }
            return [neighboursInMaze, neighboursNotInMaze, neighbours];
        }

        function evaluateWall(selectedRow, selectedColumn) {
            //if only one of the cells the wall divides is visited
            //make wall a passage and mark unvisited cell as part of maze
            //add all neighbours to wallsToCheckList
            //remove wall from wall to check list
            let neighbourInfo = getNeighbourInfo(selectedRow, selectedColumn)
            if (neighbourInfo[0].length <= 1) {
                let neighbourToInsertInfo;
                
                document.getElementById(`${selectedRow}-${selectedColumn}`).classList.remove('disabled');
                let neighbourInMaze = neighbourInfo[0][0].split('-');
                if (neighbourInMaze[0] > selectedRow && neighbourInfo[2].includes(`${selectedRow-1}-${selectedColumn}`)) {
                    neighbourToInsertInfo = getNeighbourInfo(selectedRow-1, selectedColumn);
                    if (neighbourToInsertInfo[0].length <= 1) {
                        document.getElementById(`${selectedRow-1}-${selectedColumn}`).classList.remove('disabled');
                        for (let i = 0; i < neighbourToInsertInfo[1].length; i++) {
                            wallsToCheck.push(neighbourToInsertInfo[1][i]);
                        }
                    }
                    
                } else if (neighbourInMaze[1] < selectedColumn && neighbourInfo[2].includes(`${selectedRow}-${selectedColumn+1}`)) {
                    neighbourToInsertInfo = getNeighbourInfo(selectedRow, selectedColumn+1);
                    if (neighbourToInsertInfo[0].length <= 1) {
                        document.getElementById(`${selectedRow}-${selectedColumn+1}`).classList.remove('disabled'); 
                        for (let i = 0; i < neighbourToInsertInfo[1].length; i++) {
                            wallsToCheck.push(neighbourToInsertInfo[1][i]);
                        }
                    }
                    
                } else if (neighbourInMaze[0] < selectedRow && neighbourInfo[2].includes(`${selectedRow+1}-${selectedColumn}`)) {
                    neighbourToInsertInfo = getNeighbourInfo(selectedRow+1, selectedColumn);
                    if (neighbourToInsertInfo[0].length <= 1) {
                        document.getElementById(`${selectedRow+1}-${selectedColumn}`).classList.remove('disabled');
                        for (let i = 0; i < neighbourToInsertInfo[1].length; i++) {
                            wallsToCheck.push(neighbourToInsertInfo[1][i]);
                        }
                    }
                    
                } else if (neighbourInMaze[1] > selectedColumn && neighbourInfo[2].includes(`${selectedRow}-${selectedColumn-1}`)) {
                    neighbourToInsertInfo = getNeighbourInfo(selectedRow, selectedColumn-1);
                    if (neighbourToInsertInfo[0].length <= 1) {
                        document.getElementById(`${selectedRow}-${selectedColumn-1}`).classList.remove('disabled'); 
                        for (let i = 0; i < neighbourToInsertInfo[1].length; i++) {
                            wallsToCheck.push(neighbourToInsertInfo[1][i]);
                        }
                    }
                }
                return true;
            }
            return false;
        }
  
        createGrid();
        primsMaze();
    </script>
</body>
</html>